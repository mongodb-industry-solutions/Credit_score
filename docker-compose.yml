services:
  credit-scoring-backend:
    build:
      context: .
      no_cache: true
      dockerfile: Dockerfile.backend
    image: credit-scoring-backend:latest
    volumes:
      - ~/.aws/credentials:/root/.aws/credentials:ro
      - ~/.aws/config:/root/.aws/config:ro
      - ~/.aws/sso/cache:/root/.aws/sso/cache:rw  # Only make cache writable
    ports:
      - "8080:8080"  # Backend accessible at http://localhost:8080
    restart: always
    container_name: credit-scoring-backend
    env_file:
      - ./backend/.env
    environment:
      - NODE_ENV=dev

  credit-scoring-frontend:
    build:
      context: .
      no_cache: true
      dockerfile: Dockerfile.frontend
      args:
        # Build-time: NEXT_PUBLIC_API_URL is embedded in the bundle
        # For local dev, browser needs to access backend at localhost:8080
        NEXT_PUBLIC_API_URL: http://localhost:8080
        NODE_ENV: dev
    image: credit-scoring-frontend:latest
    ports:
      - "3000:8080"  # Frontend accessible at http://localhost:3000 (runs on 8080 inside container)
    restart: always
    container_name: credit-scoring-frontend
    env_file:
      - ./frontend/.env
    environment:
      # Runtime: INTERNAL_API_URL used by Next.js API proxy routes (server-side)
      # Points to backend service name for internal Docker network communication
      INTERNAL_API_URL: http://credit-scoring-backend:8080
      NODE_ENV: dev
    depends_on:
      - credit-scoring-backend